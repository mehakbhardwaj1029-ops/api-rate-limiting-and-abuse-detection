Till now every client is getting same amount of tokens ,so if a bad client is trying to break into your service you are still again providing him with the same amount of tokens after the temporary blocking is revoked.

To make our service adaptive to different client's past behaviour we will set the system limits dynamically, which will make our service to react to potential bad clients and good clients in a different way.

High Level Architecture:

`Request
->
Fingerprint Filter
->
Block Check
->
Token Bucket (Redis Lua)
->
Adaptive Analyzer   
->
(Allow / Slow / Block)`

We are not going to use ML to implement this for now 

We'll me using deterministic heuristics by considering following patterns:

1. Burst Behaviour - It'll tell us about client's request behaviour
Normal user - will not give burst request , so they will have irregular spacing.
Bots - bots will produce request very frequently , so the burst behaviour will be uniform.

2. Violation Frequency - It will tell us how often a client's request has crossed the limits and we are already counting this while blocking clients temporarily.

3. Request Timing Pattern - If the request are coming after a specific interval of time then client is probably bot because human requested clients do not follow a specific pattern 

Scoring Based On Behaviour of Client:

1. **Normal human user**

    Requests spaced out

    Score stays at 0

    Rate limiter behaves normally

2. **Script / bot**

    10 requests in 1â€“2 seconds
    
    Requests within <100ms gaps
    
    score increases rapidly
    
    Client gets penalized earlier
    
    Block duration increases faster

3. **Attack spike**

    Huge burst
    
    Even if within token limit
    
    Adaptive score crosses threshold
    Client blocked even before bucket empties


 